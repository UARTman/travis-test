language: python

jobs:
  include:
    - name: "Python windows"
      os: windows
      language: shell
      before_install:
        - choco install openssl # Install OpenSSL -> Can't use https without it
        - choco install anaconda3 --params '"/AddToPath"' # install Conda
        - /c/tools/anaconda3/Scripts/conda init bash # initiate conda
        - /c/tools/anaconda3/Scripts/activate # activate conda
        - source /c/Users/travis/.bash_profile
        - /c/tools/anaconda3/Scripts/conda install -y m2w64-gcc libpython # dependencies for nuitka
      after_script:
        - powershell "Compress-Archive -Path test.dist -DestinationPath release-$TRAVIS_TAG"
        - ls
    - name: "Python linux"
      python: 3.7
      before_install:
        - sudo apt-get install -y chrpath
      after_script:
        - ./test.dist/test
        - tar -cvf release-$TRAVIS_TAG.tar test.dist
        - ls


before_script:
  - pip install -r requirements.txt

script:
  - python test.py
  - python -m nuitka --assume-yes-for-downloads --standalone --experimental=use_pefile test.py

deploy:
  provider: releases
  api_key: "9167f1414bf778de0e01e0e4f213f85485cf4e98"
  file: release*
  skip_cleanup: true
  on:
    tags: true
